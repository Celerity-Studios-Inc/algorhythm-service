# Staging to Development Migration Plan
## Semi-Automated Asset Migration Strategy

**Date**: July 19, 2025  
**Total Assets**: 1,681 assets  
**Migration Strategy**: Hybrid Automated + Curator Validation

---

## üìä **Current Staging Database Analysis**

### **Asset Distribution by Layer**
| Layer | Count | Percentage | Priority | Migration Strategy |
|-------|-------|------------|----------|-------------------|
| **C (Composites)** | 1,269 | 75.5% | Phase 4 | Auto-generate from components |
| **L (Looks)** | 156 | 9.3% | Phase 1 | Curator validation |
| **S (Stars)** | 88 | 5.2% | Phase 1 | Curator validation |
| **W (Worlds)** | 76 | 4.5% | Phase 1 | Curator validation |
| **M (Moves)** | 58 | 3.5% | Phase 1 | Curator validation |
| **G (Songs)** | 34 | 2.0% | Phase 2 | **Special: Curator input required** |

**Total Component Assets**: 412 (L+S+W+M+G)  
**Total Composite Assets**: 1,269 (C)

---

## üéØ **Migration Phases**

### **Phase 1: Component Assets (L, S, W, M) - 378 assets**
**Duration**: 1-2 weeks  
**Strategy**: Semi-automated with curator validation

#### **Migration Process**
1. **Auto-migration** from staging to development
2. **Auto-populate** `creatorDescription` from existing `description`
3. **Copy** existing `aiMetadata` (description and tags)
4. **Curator validation** of auto-generated content
5. **Manual refinement** if needed

#### **Technical Implementation**
```typescript
// Auto-population logic
creatorDescription: asset.description || "Auto-generated from existing description"
albumArt: null // Will be generated by frontend later
aiMetadata: asset.aiMetadata // Copy existing metadata
```

### **Phase 2: Songs Layer (G) - 34 assets** ‚ö†Ô∏è **SPECIAL HANDLING**
**Duration**: 1 week  
**Strategy**: **Manual curator input required**

#### **Why Special Handling?**
- **`creatorDescription`**: Must be provided by curator (cannot auto-generate)
- **`albumArt`**: Must be regenerated based on new `creatorDescription`
- **`aiMetadata`**: Must be regenerated based on new `creatorDescription`

#### **Migration Process**
1. **Load** each Songs asset from staging
2. **Curator provides** `creatorDescription`
3. **Frontend regenerates** `albumArt` and `aiMetadata`
4. **Save** to development database
5. **Validate** generated content

#### **Technical Implementation**
```typescript
// Special Songs migration workflow
interface SongsMigrationAsset {
  stagingAsset: Asset;
  curatorDescription: string; // Required input
  regeneratedAlbumArt: string; // Generated by frontend
  regeneratedAiMetadata: object; // Generated by frontend
}
```

### **Phase 3: Composite Assets (C) - 1,269 assets**
**Duration**: 1-2 weeks  
**Strategy**: Fully automated (requires all component assets)

#### **Prerequisites**
- ‚úÖ All L, S, W, M assets migrated and validated
- ‚úÖ All G (Songs) assets migrated and validated
- ‚úÖ Component assets available in development database

#### **Migration Process**
1. **Load** composite asset from staging
2. **Resolve** component references to development assets
3. **Auto-generate** metadata from component assets
4. **Save** to development database
5. **Validate** composite structure

---

## üõ† **Technical Implementation Plan**

### **Frontend Migration Interface**

#### **Phase 1 & 2 Interface**
```typescript
interface MigrationInterface {
  // Load next asset for curation
  loadNextAsset(layer: 'L' | 'S' | 'W' | 'M' | 'G'): Promise<StagingAsset>;
  
  // For L, S, W, M layers
  validateAutoGeneratedContent(asset: Asset): Promise<boolean>;
  
  // For G layer only
  provideCreatorDescription(assetId: string, description: string): Promise<void>;
  regenerateAlbumArt(assetId: string): Promise<string>;
  regenerateAiMetadata(assetId: string): Promise<object>;
  
  // Save migrated asset
  saveMigratedAsset(asset: Asset): Promise<void>;
}
```

#### **Phase 3 Interface**
```typescript
interface CompositeMigrationInterface {
  // Load composite asset
  loadCompositeAsset(compositeId: string): Promise<CompositeAsset>;
  
  // Resolve components to development assets
  resolveComponents(componentIds: string[]): Promise<Asset[]>;
  
  // Auto-generate composite metadata
  generateCompositeMetadata(components: Asset[]): Promise<object>;
  
  // Save composite asset
  saveCompositeAsset(composite: CompositeAsset): Promise<void>;
}
```

### **Backend Migration API**

#### **Staging Data Access**
```typescript
// New endpoints for migration
GET /api/migration/staging/assets/:layer?limit=10&offset=0
GET /api/migration/staging/asset/:id
POST /api/migration/development/asset
PUT /api/migration/development/asset/:id
```

#### **Migration Progress Tracking**
```typescript
interface MigrationProgress {
  layer: string;
  totalAssets: number;
  migratedAssets: number;
  failedAssets: number;
  currentAsset?: string;
  status: 'pending' | 'in-progress' | 'completed' | 'failed';
}
```

---

## üìã **Implementation Checklist**

### **Pre-Migration Setup**
- [ ] Initialize development database with schema
- [ ] Create migration progress tracking system
- [ ] Set up staging data access endpoints
- [ ] Create frontend migration interface
- [ ] Test migration workflow with sample assets

### **Phase 1: Component Assets (L, S, W, M)**
- [ ] Implement auto-migration script
- [ ] Create curator validation interface
- [ ] Test auto-population logic
- [ ] Migrate 378 component assets
- [ ] Validate migrated assets

### **Phase 2: Songs Layer (G)**
- [ ] Create special Songs migration interface
- [ ] Implement curator input workflow
- [ ] Test album art regeneration
- [ ] Test AI metadata regeneration
- [ ] Migrate 34 Songs assets
- [ ] Validate regenerated content

### **Phase 3: Composite Assets (C)**
- [ ] Verify all component assets migrated
- [ ] Implement component resolution logic
- [ ] Test composite metadata generation
- [ ] Migrate 1,269 composite assets
- [ ] Validate composite structures

### **Post-Migration Validation**
- [ ] Verify all 1,681 assets migrated
- [ ] Test asset relationships
- [ ] Validate metadata consistency
- [ ] Performance testing
- [ ] Rollback plan verification

---

## üö® **Risk Mitigation**

### **Data Loss Prevention**
- **Backup Strategy**: Full staging database backup before migration
- **Incremental Migration**: Layer-by-layer with validation checkpoints
- **Rollback Plan**: Ability to revert each phase independently

### **Quality Assurance**
- **Curator Oversight**: Human validation for all auto-generated content
- **Automated Validation**: Schema and relationship validation
- **Performance Monitoring**: Track migration performance and errors

### **Technical Risks**
- **API Rate Limits**: Implement throttling for staging API calls
- **Memory Usage**: Process assets in batches
- **Network Issues**: Retry logic for failed migrations

---

## üìû **Frontend Team Consultation Points**

### **Required Frontend Features**
1. **Migration Dashboard**: Progress tracking and asset management
2. **Curator Interface**: Asset validation and editing tools
3. **Songs Special Interface**: Creator description input and regeneration
4. **Composite Migration**: Component resolution and metadata generation
5. **Progress Tracking**: Real-time migration status updates

### **Technical Requirements**
1. **Staging API Integration**: Read-only access to staging data
2. **Development API Integration**: Full CRUD operations
3. **File Upload Handling**: Album art regeneration for Songs
4. **AI Integration**: Metadata regeneration for Songs layer
5. **Error Handling**: Comprehensive error recovery and reporting

### **User Experience Considerations**
1. **Batch Processing**: Allow curators to work on multiple assets
2. **Validation Workflow**: Clear approval/rejection process
3. **Progress Indicators**: Real-time migration status
4. **Error Recovery**: Ability to retry failed migrations
5. **Data Preview**: Show before/after comparison

---

## üéØ **Success Criteria**

### **Migration Completion**
- ‚úÖ All 1,681 assets successfully migrated
- ‚úÖ All Phase 2B fields populated
- ‚úÖ All asset relationships preserved
- ‚úÖ Performance maintained or improved

### **Quality Standards**
- ‚úÖ Curator validation completed for all component assets
- ‚úÖ Songs assets have proper creator descriptions
- ‚úÖ Album art regenerated for all Songs assets
- ‚úÖ Composite assets properly reference component assets

### **Technical Validation**
- ‚úÖ Schema compliance verified
- ‚úÖ API endpoints functional
- ‚úÖ Frontend integration working
- ‚úÖ Performance benchmarks met

---

**Next Steps**: Consult with frontend team on implementation approach and timeline. 